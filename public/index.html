<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noticias e Infografías</title>
    <style>
        .main-footer {
    background-color: #222; /* Fondo oscuro */
    color: white;
    text-align: center;
    padding: 30px 0;
    margin-top: auto; /* Empuja el footer al fondo */
}

.social-icons {
    margin: 20px 0;
}

.social-link {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    margin: 0 10px;
    border-radius: 50%; /* Círculo perfecto */
    background-color: #444;
    color: white;
    text-decoration: none;
    font-size: 1.2rem;
    transition: 0.3s;
}

/* Colores al pasar el mouse */
.social-link.facebook:hover { background-color: #3b5998; }
.social-link.instagram:hover { background-color: #C13584; }
.social-link.twitter:hover { background-color: #1DA1F2; }
        /* --- ESTILOS GENERALES --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; }
        h1 { text-align: center; color: #333; }
        h2 { border-bottom: 2px solid #007bff; padding-bottom: 5px; color: #444; margin-top: 40px; }
        
        .admin-link { position: absolute; top: 20px; right: 20px; text-decoration: none; color: #007bff; font-weight: bold; }
/* Contenedor del encabezado */
.main-header {
    display: flex;
    align-items: center; /* Centra verticalmente */
    background-color: #ffffff; /* O el color que uses */
    padding: 10px 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* El truco para que sea responsivo */
.responsive-logo {
    max-height: 60px; /* Altura máxima en PC */
    width: auto;      /* Mantiene la proporción */
    display: block;
}

/* Ajuste para celulares (Pantallas pequeñas) */
@media (max-width: 600px) {
    .responsive-logo {
        max-height: 40px; /* Se hace un poco más pequeño en cel */
    }
    .main-header h1 {
        font-size: 1.2rem; /* El texto también se ajusta */
        margin-left: 10px;
    }
}
.ubicacion-section {
    text-align: center;
    padding: 40px 20px;
    background-color: #f9f9f9;
}

.mapa-container iframe {
    width: 100%;       /* Ocupa todo el ancho disponible */
    max-width: 800px;  /* Pero no más de 800px en PC */
    height: 300px;     /* Altura fija */
    border-radius: 10px;
}

.btn-mapa {
    display: inline-block;
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #4285F4; /* Azul Google */
    color: white;
    text-decoration: none;
    border-radius: 5px;
}

        /* --- CONTENEDOR DE TARJETAS --- */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        
        /* --- TARJETA DE NOTICIA --- */
        .card { background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
        .card-header { padding: 15px; background: #007bff; color: white; }
        .card-header h3 { margin: 0; font-size: 1.2em; }
        .fechas { font-size: 0.8em; opacity: 0.9; margin-top: 5px; }

        /* --- SISTEMA DE PESTAÑAS (TABS) --- */
        .tabs { display: flex; background: #eee; overflow-x: auto; }
        .tab-btn { flex: 1; border: none; background: #eee; padding: 10px; cursor: pointer; font-weight: bold; color: #555; border-bottom: 3px solid transparent; white-space: nowrap; }
        .tab-btn:hover { background: #ddd; }
        .tab-btn.active { border-bottom: 3px solid #007bff; color: #007bff; background: white; }

        /* --- IMAGEN --- */
        .img-container { height: 300px; background: #ddd; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .img-container img { width: 100%; height: 100%; object-fit: contain; } /* 'contain' para ver toda la infografía */
        
        /* --- ESTILOS POR ESTADO --- */
        .seccion-vacia { color: #888; font-style: italic; }
    </style>
</head>
<body>
<header class="main-header">
    <div class="logo-container">
        <img src="/uploads/logo.png" alt="Logo del Evento" class="responsive-logo">
    </div>
    <h1>Noticias del Evento</h1>
</header>
    <a href="/login.html" class="admin-link">Ir al Admin</a>
    <h1>Portal de Eventos</h1>

    <h2> Eventos Activos</h2>
    <div id="container-activos" class="grid-container"></div>

    <h2>Próximos Eventos</h2>
    <div id="container-proximos" class="grid-container"></div>

    <h2>Historial (Pasados)</h2>
    <div id="container-pasados" class="grid-container"></div>

    <script>
        // Función principal que se ejecuta al cargar
        async function cargarNoticias() {
            try {
                const response = await fetch('/api/noticias');
                const noticias = await response.json();

                const ahora = new Date();

                // Limpiamos contenedores
                const cActivos = document.getElementById('container-activos');
                const cProximos = document.getElementById('container-proximos');
                const cPasados = document.getElementById('container-pasados');

                let countActivos = 0, countProximos = 0, countPasados = 0;

                noticias.forEach(noticia => {
                    const inicio = new Date(noticia.fecha_inicio);
                    const fin = new Date(noticia.fecha_fin);
                    
                    // Convertir el string JSON de la base de datos a Objeto JS real
                    // Si viene como objeto directo (depende de config mysql), esto lo maneja
                    let contenido = noticia.contenido_json;
                    if (typeof contenido === 'string') {
                        contenido = JSON.parse(contenido);
                    }

                    // --- LÓGICA DE CLASIFICACIÓN ---
                    let contenedorDestino;

                    if (ahora >= inicio && ahora <= fin) {
                        contenedorDestino = cActivos;
                        countActivos++;
                    } else if (ahora < inicio) {
                        contenedorDestino = cProximos;
                        countProximos++;
                    } else {
                        contenedorDestino = cPasados;
                        countPasados++;
                    }

                    // --- CREAR TARJETA HTML ---
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    // Generar botones de pestañas dinámicamente
                    let tabsHTML = '';
                    contenido.forEach((item, index) => {
                        const activeClass = index === 0 ? 'active' : '';
                        // Usamos onclick para llamar a una función que definiremos abajo
                        tabsHTML += `<button class="tab-btn ${activeClass}" onclick="cambiarPestana(this, '${item.imagen}')">${item.titulo}</button>`;
                    });

                    // HTML de la tarjeta
                    card.innerHTML = `
                        <div class="card-header">
                            <h3>${noticia.titulo_principal}</h3>
                            <div class="fechas">
                                Del: ${inicio.toLocaleDateString()} ${inicio.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} <br>
                                Al: ${fin.toLocaleDateString()} ${fin.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                        <div class="tabs">
                            ${tabsHTML}
                        </div>
                        <div class="img-container">
                            <img src="${contenido[0].imagen}" alt="Infografía">
                        </div>
                    `;

                    contenedorDestino.appendChild(card);
                });

                // Mensajes si no hay eventos
                if(countActivos === 0) cActivos.innerHTML = '<p class="seccion-vacia">No hay eventos activos en este momento.</p>';
                if(countProximos === 0) cProximos.innerHTML = '<p class="seccion-vacia">No hay eventos programados.</p>';
                
            } catch (error) {
                console.error("Error cargando noticias:", error);
            }
        }

        // --- FUNCIÓN PARA CAMBIAR IMAGEN AL DAR CLIC EN PESTAÑA ---
        // Esta función se llama desde el HTML generado arriba
        window.cambiarPestana = function(boton, urlImagen) {
            // 1. Encontrar la tarjeta padre de este botón
            const card = boton.closest('.card');
            
            // 2. Quitar clase 'active' a todos los botones de esa tarjeta
            const botones = card.querySelectorAll('.tab-btn');
            botones.forEach(btn => btn.classList.remove('active'));
            
            // 3. Poner clase 'active' al botón clickeado
            boton.classList.add('active');
            
            // 4. Cambiar la imagen
            const img = card.querySelector('.img-container img');
            img.src = urlImagen;
        }

        // Iniciar todo
        cargarNoticias();
    </script>
    <section class="ubicacion-section">
    <h2>Ubicación de los eventos</h2>
    <p>Av. Juarez 58, Colonia Centro, Centro, Cuauhtémoc, 06050 Ciudad de México, CDMX</p>
    
    <div class="mapa-container">
        <iframe src="https://www.google.com/maps/embed?pb=..." width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>

    <a href="https://maps.app.goo.gl/P4ptKeaSMFq74wK38" target="_blank" class="btn-mapa">
        Ver en Google Maps
    </a>
</section>
<footer class="main-footer">
    <h3>Síguenos en nuestras redes</h3>
    <div class="social-icons">
        <a href="https://www.facebook.com/groups/544183595780445/?ref=share&mibextid=NSMWBT" target="_blank" class="social-link facebook">
            <i class="fab fa-facebook-f"></i>
        </a>
        
        <a href="https://www.instagram.com/pokemongocdmxoficial?igsh=MTBpeXYwOHhvMHc4aw==" target="_blank" class="social-link instagram">
            <i class="fab fa-instagram"></i>
        </a>
        
        <a href="https://x.com/PoGoCDMXOficial" target="_blank" class="social-link twitter">
            <i class="fab fa-twitter"></i>
        </a>
    </div>
    <p>&copy; Yrodriguez90 - Todos los derechos reservados.</p>
</footer>
</body>
</html>